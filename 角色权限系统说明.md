# 角色权限系统说明

## 更新日期
2025年10月30日

## 功能概述
实现了基于角色的动态菜单系统，用户必须先选择角色后才能访问对应的功能模块。

## 主要改动

### 1. Home.py 重构
- 添加了角色选择界面
- 实现了动态导航系统（使用 `st.Page` 和 `st.navigation`）
- 使用 `session_state` 保存用户选择的角色
- 添加了角色权限映射

### 2. 目录结构调整
- 将 `pages/` 目录重命名为 `app_pages/`
- 原因：避免Streamlit自动加载所有页面，改为手动控制导航

### 3. 角色权限配置

| 角色 | 可访问功能 | 菜单编号 |
|------|-----------|---------|
| **Manual Tester** | 🧪 Generate Test Cases<br>💬 Guideline Chatbot<br>🛠️ Tools<br>🤖 AI Assistant | 1, 2, 5, 6 |
| **Automation Tester** | 💬 Guideline Chatbot<br>⚙️ AI Automation<br>🛠️ Tools<br>🤖 AI Assistant | 2, 3, 5, 6 |
| **BA** | 💬 Guideline Chatbot<br>📊 BA工具集<br>🛠️ Tools<br>🤖 AI Assistant | 2, 4, 5, 6 |

## 使用流程

1. **启动应用**
   ```bash
   streamlit run Home.py
   ```

2. **选择角色**
   - 进入首页后，会看到三个角色选择卡片
   - 点击对应的角色按钮（Manual Tester / Automation Tester / BA）

3. **访问功能**
   - 选择角色后，左侧边栏会显示该角色可访问的功能模块
   - 点击菜单项即可访问对应功能

4. **切换角色**
   - 在首页点击"🔄 切换角色"按钮可重新选择角色

## 技术实现细节

### 角色状态管理
```python
# 使用session_state保存用户角色
if 'user_role' not in st.session_state:
    st.session_state.user_role = None
```

### 权限配置
```python
ROLE_PERMISSIONS = {
    "Manual Tester": [1, 2, 5, 6],
    "Automation Tester": [2, 3, 5, 6],
    "BA": [2, 4, 5, 6]
}
```

### 动态导航构建
```python
def build_navigation():
    if st.session_state.user_role is None:
        return None
    
    role = st.session_state.user_role
    allowed_pages = ROLE_PERMISSIONS.get(role, [])
    
    pages = []
    for page_num in sorted(allowed_pages):
        page_info = PAGE_INFO[page_num]
        pages.append(
            st.Page(
                page_info["file"],
                title=page_info["title"],
                icon=page_info["icon"]
            )
        )
    
    return pages
```

## 如何添加新角色或修改权限

### 添加新角色
在 `Home.py` 中修改 `ROLE_PERMISSIONS` 字典：

```python
ROLE_PERMISSIONS = {
    "Manual Tester": [1, 2, 5, 6],
    "Automation Tester": [2, 3, 5, 6],
    "BA": [2, 4, 5, 6],
    "新角色名称": [可访问的页面编号列表]  # 添加新行
}
```

然后在 `show_home_page()` 函数中添加新的角色选择按钮和卡片。

### 修改现有角色权限
直接修改 `ROLE_PERMISSIONS` 字典中对应角色的页面编号列表即可。

### 添加新页面
1. 在 `app_pages/` 目录下创建新的页面文件
2. 在 `PAGE_INFO` 字典中添加页面信息：
   ```python
   PAGE_INFO = {
       # ... 现有页面 ...
       7: {"icon": "🆕", "title": "新页面", "file": "app_pages/7_🆕_新页面.py"}
   }
   ```
3. 在 `ROLE_PERMISSIONS` 中为需要访问该页面的角色添加对应编号

## 版本信息
- 原版本：1.3.0
- 当前版本：2.0.0
- 更新内容：实现角色权限系统

## 注意事项
1. 必须先选择角色才能访问功能模块
2. 不同角色看到的菜单不同，这是正常现象
3. 如需切换角色，请在首页点击"切换角色"按钮
4. `app_pages/` 目录不要重命名为 `pages/`，否则会导致自动路由冲突

